{% extends "base.html" %}

{% block title %}Dashboard - Sistema de Botiquines{% endblock %}

{% block extra_css %}
<style>
.dashboard-card {
    border-radius: 0.75rem;
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.05);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.dashboard-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 1rem 2rem rgba(0, 0, 0, 0.08);
}

.metric-value {
    font-weight: 700;
    font-size: 1.75rem;
}

.botiquin-card .badge {
    font-size: 0.75rem;
}

.botiquin-meta {
    font-size: 0.85rem;
}
</style>
{% endblock %}

{% block content %}
<div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-4">
    <div>
        <h1 class="h3 mb-1">Panel general</h1>
        <p class="text-muted mb-0">
            {% if user.is_super_admin() %}
                Supervisando todas las empresas conectadas.
            {% elif user.company %}
                Resumen del botiquín para {{ user.company.name }}.
            {% else %}
                Resumen de tus botiquines.
            {% endif %}
        </p>
    </div>
    <div class="text-end">
        <a class="btn btn-sm btn-outline-primary" href="/inventory">
            <i class="bi bi-list-ul"></i> Ver inventario completo
        </a>
    </div>
</div>

<div class="row g-3 mb-4">
    <div class="col-sm-6 col-lg-3">
        <div class="card dashboard-card border-0">
            <div class="card-body">
                <div class="text-muted text-uppercase small mb-1">Botiquines</div>
                <div class="metric-value text-primary">{{ summary.total_botiquines }}</div>
            </div>
        </div>
    </div>
    <div class="col-sm-6 col-lg-3">
        <div class="card dashboard-card border-0">
            <div class="card-body">
                <div class="text-muted text-uppercase small mb-1">Medicinas</div>
                <div class="metric-value text-success">{{ summary.total_medicines }}</div>
            </div>
        </div>
    </div>
    <div class="col-sm-6 col-lg-3">
        <div class="card dashboard-card border-0">
            <div class="card-body">
                <div class="text-muted text-uppercase small mb-1">Alertas críticas</div>
                <div class="metric-value text-danger">{{ summary.critical }}</div>
            </div>
        </div>
    </div>
    <div class="col-sm-6 col-lg-3">
        <div class="card dashboard-card border-0">
            <div class="card-body">
                <div class="text-muted text-uppercase small mb-1">Alertas preventivas</div>
                <div class="metric-value text-warning">{{ summary.warning }}</div>
            </div>
        </div>
    </div>
    {% if summary.companies is not none %}
    <div class="col-sm-6 col-lg-3">
        <div class="card dashboard-card border-0">
            <div class="card-body">
                <div class="text-muted text-uppercase small mb-1">Empresas activas</div>
                <div class="metric-value text-info">{{ summary.companies }}</div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<div class="row g-3">
    {% for bot in botiquines %}
    <div class="col-xxl-3 col-xl-4 col-md-6">
        <div class="card dashboard-card botiquin-card h-100 border-0">
            <div class="card-body d-flex flex-column">
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <div>
                        <h2 class="h5 mb-1">{{ bot.name }}</h2>
                        <p class="botiquin-meta text-muted mb-1">
                            <i class="bi bi-geo-alt"></i>
                            {{ bot.location or 'Ubicación no especificada' }}
                        </p>
                    </div>
                    {% if show_company and bot.company %}
                    <span class="badge bg-primary">{{ bot.company }}</span>
                    {% endif %}
                </div>

                <div class="botiquin-meta text-muted mb-3">
                    <div><strong>Total medicinas:</strong> {{ bot.medicines_count }}</div>
                    <div><strong>Críticos:</strong> {{ bot.critical }} · <strong>Alertas:</strong> {{ bot.warning }}</div>
                    <div><strong>Compartimentos:</strong> {{ bot.compartments_used }}/{{ bot.compartments_total }}</div>
                    <div><strong>Última sincronización:</strong> {{ bot.last_sync }}</div>
                </div>

                <div class="mt-auto d-flex gap-2">
                    <a class="btn btn-sm btn-primary" href="/botiquin/{{ bot.id }}">
                        <i class="bi bi-grid"></i> Ver detalles
                    </a>
                    <a class="btn btn-sm btn-outline-secondary" href="/api/botiquines/{{ bot.id }}">
                        <i class="bi bi-diagram-3"></i> Datos API
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% else %}
    <div class="col-12">
        <div class="alert alert-info d-flex align-items-center" role="alert">
            <i class="bi bi-info-circle me-2"></i>
            {% if user.is_super_admin() %}
                No hay botiquines registrados actualmente.
            {% else %}
                No hay botiquines activos asociados a tu empresa.
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}
